<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8" name="description" content="Личный кабинет">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Bootstrap demo</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
		<link href="../css/main.css" rel="stylesheet">
		<link href="../css/light.css" rel="stylesheet" media="(prefers-color-scheme: light)">
		<link href="../css/dark.css" rel="stylesheet" media="(prefers-color-scheme: dark)">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
	</head>
	<body>
		<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none">

			//иконка календарь
			<symbol id="calendar" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" height="50" fill="currentColor" viewBox="0 0 50 50">
				<path fill-rule="evenodd" d="M 0 9 L 0 11 L 50 11 L 50 9 Z M 0 24 L 0 26 L 50 26 L 50 24 Z M 0 39 L 0 41 L 50 41 L 50 39 Z"/>
			</symbol>

			//иконка вход
			<symbol id="ent" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
			width="24" height="24"
			fill="currentColor"
			viewBox="0 0 24 24">
				<path fill-rule="evenodd" d="M 12 1 C 8.6761905 1 6 3.6761905 6 7 L 6 8 C 4.9 8 4 8.9 4 10 L 4 20 C 4 21.1 4.9 22 6 22 L 18 22 C 19.1 22 20 21.1 20 20 L 20 10 C 20 8.9 19.1 8 18 8 L 18 7 C 18 3.6761905 15.32381 1 12 1 z M 12 3 C 14.27619 3 16 4.7238095 16 7 L 16 8 L 8 8 L 8 7 C 8 4.7238095 9.7238095 3 12 3 z M 12 13 C 13.1 13 14 13.9 14 15 C 14 16.1 13.1 17 12 17 C 10.9 17 10 16.1 10 15 C 10 13.9 10.9 13 12 13 z"/>
			</symbol>
		
			//иконка выход
			<symbol id="exit" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
			width="24" height="24"
			fill="currentColor"
			viewBox="0 0 24 24">
				<path fill-rule="evenodd" d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/>
			</symbol>

			//личный кабинет
			<symbol id="lk" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
				<path d="M 12 2 C 7.582 2 4 5.582 4 10 L 4 11 L 4 11.902344 C 3.426291 12.449411 3 13.153146 3 14 C 3 15.241968 3.8575508 16.162904 4.9433594 16.613281 C 6.2443933 19.723094 8.8502365 22 12 22 C 15.149764 22 17.755607 19.723094 19.056641 16.613281 C 20.142449 16.162904 21 15.241968 21 14 C 21 13.153146 20.573709 12.449411 20 11.902344 L 20 11 L 20 10 C 20 5.582 16.418 2 12 2 z M 7 10 L 17 10 C 17.552 10 18 10.448 18 11 L 18 12 L 18 12.271484 A 1.0001 1.0001 0 0 0 18.501953 13.138672 C 18.805591 13.312973 19 13.615008 19 14 C 19 14.515121 18.631169 14.912712 18.138672 14.980469 A 1.0001 1.0001 0 0 0 17.339844 15.613281 C 16.309043 18.299502 14.258448 20 12 20 C 9.7415517 20 7.6909574 18.299502 6.6601562 15.613281 A 1.0001 1.0001 0 0 0 5.8613281 14.980469 C 5.3688308 14.912712 5 14.515121 5 14 C 5 13.615008 5.1944088 13.312973 5.4980469 13.138672 A 1.0001 1.0001 0 0 0 6 12.271484 L 6 12 L 6 11 C 6 10.448 6.448 10 7 10 z"/>
			</symbol>
			
			//иконка адрес
			<symbol id="addr" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 48 48">
				<path d="M 12 2 C 6.4889971 2 2 6.4889971 2 12 C 2 17.511003 6.4889971 22 12 22 C 17.511003 22 22 17.511003 22 12 C 22 6.4889971 17.511003 2 12 2 z M 12 4 C 16.430123 4 20 7.5698774 20 12 C 20 16.430123 16.430123 20 12 20 C 7.5698774 20 4 16.430123 4 12 C 4 7.5698774 7.5698774 4 12 4 z"/>
			</symbol>

			//иконка тип мероприятия
			<symbol id="type" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-train-front" viewBox="0 0 24 24">
				<path d="M12,2C6.477,2,2,6.477,2,12s4.477,10,10,10s10-4.477,10-10S17.523,2,12,2z M12,17L12,17c-0.552,0-1-0.448-1-1v-4 c0-0.552,0.448-1,1-1h0c0.552,0,1,0.448,1,1v4C13,16.552,12.552,17,12,17z M12.5,9h-1C11.224,9,11,8.776,11,8.5v-1 C11,7.224,11.224,7,11.5,7h1C12.776,7,13,7.224,13,7.5v1C13,8.776,12.776,9,12.5,9z"/>
			</symbol>

			//записаться
			<symbol id="add" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 24 24">
				<path d="M12,2C6.477,2,2,6.477,2,12s4.477,10,10,10s10-4.477,10-10S17.523,2,12,2z M16,13h-3v3c0,0.552-0.448,1-1,1h0 c-0.552,0-1-0.448-1-1v-3H8c-0.552,0-1-0.448-1-1v0c0-0.552,0.448-1,1-1h3V8c0-0.552,0.448-1,1-1h0c0.552,0,1,0.448,1,1v3h3 c0.552,0,1,0.448,1,1v0C17,12.552,16.552,13,16,13z"/>
			</symbol>

			//на главную
			<symbol id="home" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" fill="currentColor" height="50" viewBox="0 0 50 50">
				<path d="M 25 1.0507812 C 24.7825 1.0507812 24.565859 1.1197656 24.380859 1.2597656 L 1.3808594 19.210938 C 0.95085938 19.550938 0.8709375 20.179141 1.2109375 20.619141 C 1.5509375 21.049141 2.1791406 21.129062 2.6191406 20.789062 L 4 19.710938 L 4 46 C 4 46.55 4.45 47 5 47 L 19 47 L 19 29 L 31 29 L 31 47 L 45 47 C 45.55 47 46 46.55 46 46 L 46 19.710938 L 47.380859 20.789062 C 47.570859 20.929063 47.78 21 48 21 C 48.3 21 48.589063 20.869141 48.789062 20.619141 C 49.129063 20.179141 49.049141 19.550938 48.619141 19.210938 L 25.619141 1.2597656 C 25.434141 1.1197656 25.2175 1.0507812 25 1.0507812 z M 35 5 L 35 6.0507812 L 41 10.730469 L 41 5 L 35 5 z"/>
			</symbol>
		</svg>
		<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none">
			
		</svg>

		<header class="header">
			<nav class="navbar navbar-expand-lg navbar-expand-xl navbar-light">
				<div class="container">
					<a class="navbar-brand nav-text ms-0 me-0" href="./calendar.html">
						<svg class="icon-main">
							<use xlink:href="#calendar"></use>
						</svg>
						Календрь мероприятий
					</a>
					<a class="navbar-brand nav-text ms-0 me-0 px-5" href="./main.html">
						<svg class="icon-main">
							<use xlink:href="#home"></use>
						</svg>
						Главная
					</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarSupportedContent">
						<ul class="quit navbar-nav mb-lg-0">
							<li>
								<a class="nav-link active nav-text" id="logout" href="#">
									<svg class="icon-main">
										<use xlink:href="#exit"></use>
									</svg>
									Выход</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>
		<main class=" row mx-auto d-flex pt-5 color-main">
			<section class="container row mx-auto">
				<div class="row d-flex justify-content-start col-md-5 col-lg-5 col-xl-3 col-12 col-sm-12 mx-5 mt-5">
					<img src="./Ава.jpg" alt="..." style="padding: 0">
				</div>
				<div class="row d-flex justify-content-start col-xl-6 col-lg-7 col-md-7 col-9 col-sm-12 mt-5">
					<ul>
						<h1 class="text mt-1 custom-colored-h2 mt-5 mb-5 mx-5" style="color:#fff">Пользователь: Еремеева Арина</h1>
						<h2 class="text mt-2 h4 custom-colored-h2 mx-5" style="color:#fff">Зарегистрирован: 10 декабря 2022</h2>
						<h3 class="text mt-2 h4 custom-colored-h2 mx-5" style="color:#fff">Интересы: фото/рисунок/живопись/видео/искусство</h3>
						<h3 class="text mt-4 h4 custom-colored-h2 mx-5" style="color:#fff">Страница VK:<a style="color:#fff" href="https://vk.com/arrrishaaaaaaaaa">https://vk.com/arrrishaaaaaaaaa</a></h3>
						<button type="button" class="btn btn-primary mt-5 button-color px-3 mx-5">Редактировать профиль</button>
					</ul>
				</div>
			</section>
			<section class="container row mx-auto" id="container">
				<h3 class="text h4 custom-colored-h1 mt-5 mb-5 mx-5">Мероприятия, на которые вы записаны:</h3>

			</section>
		</main>
		<script>
			const idLogOut = document.querySelector('#logout')
			const userId = JSON.parse(localStorage.user).id; 
			let users = []; 
			let events = []; 
			const myUsersEvents = []; 
			const myEvents = []; 
			const mainId = []
			
			async function getUsers() { 
				const response = await fetch('http://localhost:3000/userEvents', { 
					headers: { 
						'Content-Type': 'application/json' 
					} 
				}) 
				const jsonResponse = await response.json(); 
				console.log('response', jsonResponse); 
				jsonResponse.forEach(user => { 
					if (user.userId === userId) { 
						myUsersEvents.push(user.eventId); 
						mainId.push(user);
					} 
				}) 
			} 
			
			async function getEvents() { 
				const response = await fetch('http://localhost:3000/notes', { 
					headers: { 
					'Content-Type': 'application/json' 
					} 
				}) 
				const jsonResponse = await response.json(); 
				console.log('response', jsonResponse); 
				events = jsonResponse; 
				console.log(events) 
				events.forEach(item => { 
					if (myUsersEvents.includes(item.id)) {
						myEvents.push(item) 
					} 
				})
				console.log("myevents", myEvents)
				console.log("myeventsuser", myUsersEvents)
				console.log("main", mainId) 
				for (let i = 0; i < myEvents.length; i++ ) { 
					document.querySelector("#container").innerHTML += getCardHtml(myEvents[i].id, myEvents[i].mero, myEvents[i].data, myEvents[i].metro, myEvents[i].address, myEvents[i].id); 
				} 
			}

			async function deleteCard(event, id) { 
				for (let i = 0; i < mainId.length; i++) {
					if (id === mainId[i].eventId && userId === mainId[i].userId) {
						const link = 'http://localhost:3000/userEvents/' + mainId[i].id;
						console.log(link);
						const response = await fetch(link, {
							method: "DELETE",
							headers: {
								'Content-Type': 'application/json'
							}
						})
					}
				}
			}

			function getCardHtml(id, mero, data, metro, address) {
				return `
				<div class="card card-color mx-5 mb-5" data-card-id=${id} style="width: 18rem;">
						<div class="card-body">
							<h5 class="card-title text-card">${mero}</h5>
							<p class="card-text text-card">${data}</p>
							<p class="card-text text-card">
								<svg class="icon-main">
									<use xlink:href="#addr"></use>
								</svg>${address}</p>
							<p class="card-text text-card">
								<svg class="icon-main">
									<use xlink:href="#type"></use>
								</svg>${metro}</p>
							<form onsubmit="deleteCard(event, ${id})">
								<button type="submit" class="btn btn-primary button-color">Отписаться</button>
							</form>
						</div>
					</div> `
			}

			function logout() {
				localStorage.clear();
				window.location.href = "http://localhost:8000/html/entrance.html";
			}
			idLogOut.addEventListener('click', logout)

			getUsers();
			getEvents();
		</script>
	</body>
</html>