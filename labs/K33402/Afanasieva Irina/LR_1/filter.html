<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Выберите коттедж</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="./styles/style-filter.css">
    <link rel="icon" type="images/x-icon" href="./images/icons8-home-16.ico">
    </head>
  <body>
    <header>
      <nav class="navbar-menu">
            <ul class="navbar-link">
              <li class="nav-item-left">
                <a class="nav-link" href="file:///C:/Users/Irina/Desktop/%D0%A1%D0%B5%D0%BC%D0%B8%D0%BD%D0%B0%D1%80%D1%8B/%D0%A4%D1%80%D0%B0%D0%BD%D1%82%D0%B5%D0%BD%D0%B4%D0%B5%D0%BA%D0%B8/LR1_Afanasieva_Irina/main.html">Главная</a>
              </li>
              <li class="nav-item-left">
                <a class="nav-link" href="#info-main">О нас</a>
              </li>
              <li class="nav-item-left">
                <a class="nav-link" href="#house-container">Домики</a>
              </li>
              <li class="nav-item-left">
                <a class="nav-link" href="#">Галерея</a>
              </li>
              <li class="nav-item-left">
                <a class="nav-link" href="#footer">Контакты</a>
              </li>
              <li class="nav-item-right">
                <a class="nav-link" href="file:///C:/Users/Irina/Desktop/%D0%A1%D0%B5%D0%BC%D0%B8%D0%BD%D0%B0%D1%80%D1%8B/%D0%A4%D1%80%D0%B0%D0%BD%D1%82%D0%B5%D0%BD%D0%B4%D0%B5%D0%BA%D0%B8/LR1_Afanasieva_Irina/enter.html?#">Вход/Регистрация</a>
              </li>
            </ul>
      </nav>
    </header>
    <main>
      <form onsubmit="filterHouses(event)">
      <section class="filter-form">
        <h2 class="filter-title">Выберите идеальный домик</h2>
        <section class="filter-section">
          <span class="filter-text">Количество человек</span>
          <select class="form-select form-select-lg mb-3 number-visitors-form" aria-label=".form-select-lg пример" id="people">
            <option selected></option>
            <option value="1">4</option>
            <option value="2">6</option>
            <option value="3">8</option>
            <option value="4">10</option>
          </select>
        </section>
        <section class="filter-section">
          <span class="filter-text">Цена</span>
          <select class="form-select form-select-lg mb-3 number-visitors-form" aria-label=".form-select-lg пример" id="price">
            <option selected></option>
            <option value="1">1900</option>
            <option value="2">2900</option>
            <option value="3">3900</option>
            <option value="4">4900</option>
          </select>
        </section>
        <!-- <section class="filter-section">
          <span class="filter-text">Животные</span>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions1" id="inlineRadio1" value="option1">
            <label class="form-check-label" for="inlineRadio1">Да</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions2" id="inlineRadio2" value="option2">
            <label class="form-check-label" for="inlineRadio2">Нет</label>
          </div>
        </section>
        <section class="filter-section">
          <span class="filter-text">Парковка</span>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions3" id="inlineRadio3" value="option12">
            <label class="form-check-label" for="inlineRadio1">Да</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions4" id="inlineRadio4" value="option22">
            <label class="form-check-label" for="inlineRadio2">Нет</label>
          </div>
        </section>
        <section class="filter-section">
          <span class="filter-text">Завтраки</span>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions5" id="inlineRadio5" value="option13">
            <label class="form-check-label" for="inlineRadio3">Да</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions6" id="inlineRadio6" value="option23">
            <label class="form-check-label" for="inlineRadio4">Нет</label>
          </div>
        </section> -->
        <div class="form-check">
          <input class="form-check-input" type="checkbox"  id="terrace">
          <label class="form-check-label" for="flexCheckDefault">
            Терраса
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="kitchen">
          <label class="form-check-label" for="flexCheckDefault">
            Кухня
          </label>
        </div>
        <!-- <section class="filter-section">
          <span class="filter-text">Дети</span>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio5" value="option1">
            <label class="form-check-label" for="inlineRadio5">Да</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio6" value="option2">
            <label class="form-check-label" for="inlineRadio6">Нет</label>
          </div>
        </section> -->


          <input class="form-control me-2" type="search" placeholder="Поиск" aria-label="Поиск" id="searchTitle">
        <button type="submit" class="btn btn-primary">Поиск</button>
      </section>
    </form>



      <div class="row row-cols-1 row-cols-md-2 g-4 houses-block" id="houses">

      </div>
    </main>
    <footer id=footer>
      <img src="./images/logo.png" class="footer-logo" alt="Логотип">
      <a class="footer-link" href="#">О нас</a>
      <a class="footer-link" href="#">Галерея</a>
      <a class="footer-link" href="#">Развлечения</a>
      <a class="footer-link" href="#">Карта</a>
      <a class="footer-link" href="#">Акции</a>
      <a class="footer-link" href="#">Контакты</a>
      <p class="footer-link">8-903-609-75-94</p>
      <p class="footer-link">8-906-365-15-26</p>
      <p class="footer-link">diogen@gmail.com</p>
    </footer>
    <script>
      function getCardHtml({ id, title, price, people, terrace, kitchen, imgUrl}) {

        return `
        <div class="card">
          <img src="${imgUrl}" class="card-img-top" alt="маленький дом">
          <div class="card-body">
            <h5 class="card-title">${title}</h5>
            <p>${price} Р/сут</p>
            <p class="card-text">Размещение до ${people} человек ${terrace ? '<br>Собственная терасса' : ''}${kitchen ? '<br>Кухня со всем необходимым' : ''}</p>
            <button class="btn-more">
              <a href="#" class="btn-link">Узнать больше --------></a>
            </button>
            <button class="btn-card">
              <a href="#" class="btn-link">Забронировать</a>
            </button>
          </div>
        </div>
          `

      }

      function getAuthToken() {
        return localStorage.accessToken
      }
      
      async function filterHouses(){

        event.preventDefault()
        const title_like = document.getElementById("searchTitle").value;
        const people = document.getElementById("people").value;
        const price = document.getElementById("price").value;
        const terrace = document.getElementById("terrace").checked;
        const kitchen = document.getElementById("kitchen").checked;
        
        await loadHouses({title_like,people,price,terrace,kitchen })
      }

      async function loadHouses(params = {}) {
        let url = "http://localhost:3000/664/houses"

        const searchParams = new URLSearchParams()
        for (const param in params ){
          if (params[param]){
            searchParams.set(param, params[param])
          }
        }
        const searchParamsString = searchParams.toString()
        url = `${url}?${searchParamsString}`
         console.log(url)
        const response = await fetch(url, {
          headers: {
            "Authorization": `Bearer ${getAuthToken()}`
          }
        })


        const responseJson = await response.json()

        console.log('response', responseJson)

        document.querySelector("#houses").innerHTML = ''

        for (const house of responseJson) {

          document.querySelector("#houses").innerHTML += getCardHtml(house)
        }
      } 

      document.addEventListener('DOMContentLoaded', () => {
        loadHouses()
      })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    </body>
